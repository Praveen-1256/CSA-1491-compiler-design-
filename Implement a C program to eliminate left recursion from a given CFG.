#include <stdio.h>
#include <string.h>
#include <ctype.h>
#define MAX_PRODUCTIONS 100
#define MAX_PROD_SIZE 50

char productions[MAX_PRODUCTIONS][MAX_PROD_SIZE];
char non_terminals[MAX_PRODUCTIONS];
int num_productions = 0;
int num_non_terminals = 0;

void eliminate_left_recursion(char non_terminal) {
    int i;
    char new_non_terminal = non_terminal + 1;
    int found_recursion = 0;
    int first_prod = num_productions;
    int last_prod = num_productions - 1;
    for (i = 0; i < num_productions; i++) {
        if (productions[i][0] == non_terminal) {
            if (!found_recursion) {
                found_recursion = 1;             
                non_terminals[num_non_terminals++] = new_non_terminal; 
                sprintf(productions[last_prod--], "%c", new_non_terminal);
            }            
            char* current_production = productions[i];
            char* next_char = current_production + 1;
            char* new_production = productions[num_productions];
            while (*next_char != '\0') {
                if (*next_char == non_terminal) {                  
                    sprintf(new_production, "%c%c'", new_non_terminal, non_terminal);
                    new_production += 2;
                } else {
                    *new_production++ = *next_char;
                }
                next_char++;
            }
            *new_production = '\0';
            sprintf(productions[num_productions++], "%c%c'", new_non_terminal, non_terminal);
        }
    }
    // Add new productions for new non-terminal
    sprintf(productions[num_productions++], "%c", new_non_terminal);
    sprintf(productions[num_productions++], "%c%c'", new_non_terminal, non_terminal);
    for (i = first_prod; i < num_productions; i++) {
        if (productions[i][0] != non_terminal) {
            sprintf(productions[last_prod--], "%s%c'", productions[i], new_non_terminal);
        }
    }
}

int main() {
    char input[MAX_PROD_SIZE];
    printf("Enter the CFG:\n");
    while (fgets(input, MAX_PROD_SIZE, stdin) != NULL) {
        
        input[strcspn(input, "\n")] = '\0';
        // Add production to productions array
        strcpy(productions[num_productions++], input);
        
        if (isupper(input[0]) && input[1] == '-') {
            non_terminals[num_non_terminals++] = input[0];
        }
    }
   
    int i;
    for (i = 0; i < num_non_terminals; i++) {
        eliminate_left_recursion(non_terminals[i]);
    }
   
    printf("\nThe resulting CFG:\n");
    for (i = 0; i < num_productions; i++) {
        printf("%s\n", productions[i]);
    }
    return 0;
}
